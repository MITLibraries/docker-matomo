(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin","SegmentEditor"],t):"object"===typeof exports?exports["CustomReports"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin"),require("SegmentEditor")):e["CustomReports"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"],e["SegmentEditor"])})("undefined"!==typeof self?self:this,(function(e,t,o,i){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(i,r,function(t){return e[t]}.bind(null,r));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="plugins/CustomReports/vue/dist/",o(o.s="fae3")}({"19dc":function(t,o){t.exports=e},"8bbf":function(e,o){e.exports=t},a5a2:function(e,t){e.exports=o},f06f:function(e,t){e.exports=i},fae3:function(e,t,o){"use strict";if(o.r(t),o.d(t,"ReportEdit",(function(){return vt})),o.d(t,"ReportsList",(function(){return co})),o.d(t,"ReportsManage",(function(){return vo})),"undefined"!==typeof window){var i=window.document.currentScript,r=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(o.p=r[1])}var s=o("8bbf");const n={class:"loadingPiwik"},a=Object(s["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),l={class:"loadingPiwik"},c=Object(s["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),d={class:"alert alert-warning"},p={key:0},m={key:1},u={key:0,class:"alert alert-warning"},h=["innerHTML"],b={key:1},v={name:"name"},O={name:"description"},j={class:"form-group row"},g={class:"col s12"},R={class:"col s12 m6"},y={for:"all_websites",class:"siteSelectorLabel"},C={class:"sites_autocomplete"},f={class:"col s12 m6"},S={class:"form-help"},E={key:0,class:"inline-help"},N={key:1,class:"inline-help"},k={key:0,class:"col s12 m6"},V={key:0},w={for:"websitecontains"},D=Object(s["createElementVNode"])("br",null,null,-1),_=["placeholder"],M=["disabled","value"],A={key:1},B=Object(s["createElementVNode"])("br",null,null,-1),U={class:"entityTable"},I={class:"siteId"},L={class:"siteName"},T={key:0,class:"siteAction"},x={colspan:"3"},P={key:0,class:"siteAction"},H=["onClick"],G={class:"form-group row"},F={class:"col s12"},q={class:"unlockAlert alert alert-info"},W={key:0},z={key:1},Y=Object(s["createElementVNode"])("br",null,null,-1),Q=Object(s["createElementVNode"])("br",null,null,-1),X=["value"],J={class:"alertUnlocked alert alert-warning"},K={key:0},Z={key:1},ee={name:"reportType"},te={class:"form-group row"},oe={class:"col s12 m6 dimensionsGroup"},ie=Object(s["createElementVNode"])("br",null,null,-1),re={class:"groupValueSelect",name:"dimensions"},se=["title","onClick"],ne={class:"groupValueSelect addDimension",name:"dimensions"},ae={class:"col s12 m6"},le={class:"form-help"},ce=["innerHTML"],de={class:"form-group row"},pe={class:"col s12 m6 metricsGroup"},me=Object(s["createElementVNode"])("br",null,null,-1),ue={class:"groupValueSelect",name:"metrics"},he=["title","onClick"],be={class:"groupValueSelect addMetric",name:"metrics"},ve={class:"col s12 m6"},Oe={class:"form-help"},je={class:"inline-help"},ge=["innerHTML"],Re={class:"form-group row segmentFilterGroup"},ye={class:"col s12"},Ce={style:{margin:"8px 0",display:"inline-block"}},fe={class:"form-group row"},Se={class:"col s12"},Ee=Object(s["createElementVNode"])("br",null,null,-1),Ne=Object(s["createElementVNode"])("br",null,null,-1),ke={name:"reportCategories"},Ve={name:"reportSubcategories"},we={class:"alert alert-warning"},De={key:0},_e={key:1},Me={class:"alert alert-warning"},Ae={key:0},Be={key:1},Ue={key:0,class:"form-group row"},Ie=["textContent"],Le={class:"col s12 m6"},Te={id:"childReports",class:"col s12 m6"},xe=["data-id"],Pe=Object(s["createElementVNode"])("span",{class:"ui-icon ui-icon-arrowthick-2-n-s"},null,-1),He={class:"col s12 m6"},Ge={class:"form-help"},Fe=["textContent"],qe={class:"entityCancel"},$e={class:"ui-confirm",id:"confirmUnlockReport",ref:"confirmUnlockReport"},We={key:0},ze={key:1},Ye=["value"],Qe=["value"],Xe={class:"ui-confirm",id:"infoReportIsLocked",ref:"infoReportIsLocked"},Je={key:0},Ke={key:1},Ze=["value"],et=["value"];function tt(e,t,o,i,r,$){const tt=Object(s["resolveComponent"])("Field"),ot=Object(s["resolveComponent"])("SiteSelector"),it=Object(s["resolveComponent"])("SegmentGenerator"),rt=Object(s["resolveComponent"])("SaveButton"),st=Object(s["resolveComponent"])("ContentBlock");return Object(s["openBlock"])(),Object(s["createBlock"])(st,{class:"editReport","content-title":e.contentTitle},{default:Object(s["withCtx"])(()=>{var o,i,r;return[Object(s["withDirectives"])(Object(s["createElementVNode"])("p",null,[Object(s["createElementVNode"])("span",n,[a,Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(e.translate("General_LoadingData")),1)])],512),[[s["vShow"],e.isLoading]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("p",null,[Object(s["createElementVNode"])("span",l,[c,Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(e.translate("CustomReports_UpdatingData")),1)])],512),[[s["vShow"],e.isUpdating]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",d,[e.multipleSites.length&&!e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",p,Object(s["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")),1)):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",m,Object(s["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")),1))],512),[[s["vShow"],!e.canEdit]]),"paused"===e.report.status?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",u,[e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",{key:0,innerHTML:e.getPausedStateAdminMessage},null,8,h)):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",b,Object(s["toDisplayString"])(e.translate("CustomReports_NoDataMessagePausedStateNonAdminUser")),1))])):Object(s["createCommentVNode"])("",!0),Object(s["createElementVNode"])("form",{onSubmit:t[15]||(t[15]=t=>e.edit?e.updateReport():e.createReport())},[Object(s["createElementVNode"])("div",null,[Object(s["createElementVNode"])("div",v,[Object(s["createVNode"])(tt,{uicontrol:"text",name:"name","model-value":e.report.name,"onUpdate:modelValue":t[0]||(t[0]=t=>{e.report.name=t,e.setValueHasChanged()}),title:e.translate("General_Name"),maxlength:50,disabled:!e.canEdit,placeholder:e.translate("CustomReports_FieldNamePlaceholder"),"inline-help":e.translate("CustomReports_ReportNameHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(s["createElementVNode"])("div",O,[Object(s["createVNode"])(tt,{uicontrol:"textarea",name:"description","model-value":e.report.description,"onUpdate:modelValue":t[1]||(t[1]=t=>{e.report.description=t,e.setValueHasChanged()}),title:e.translate("General_Description")+" (optional)",maxlength:1e3,disabled:!e.canEdit,rows:3,placeholder:e.translate("CustomReports_FieldDescriptionPlaceholder"),"inline-help":e.translate("CustomReports_ReportDescriptionHelp")},null,8,["model-value","title","disabled","placeholder","inline-help"])]),Object(s["createElementVNode"])("div",j,[Object(s["createElementVNode"])("h3",g,Object(s["toDisplayString"])(e.translate("CustomReports_ApplyTo")),1),Object(s["createElementVNode"])("div",R,[Object(s["createElementVNode"])("div",null,[Object(s["createElementVNode"])("label",y,Object(s["toDisplayString"])(e.translate("General_Website")),1),Object(s["createElementVNode"])("div",C,[Object(s["createVNode"])(ot,{id:"all_websites","model-value":e.report.site,"onUpdate:modelValue":t[2]||(t[2]=t=>{e.report.site=t,e.setWebsiteChanged(t)}),"show-all-sites-item":e.isSuperUser,"switch-site-on-select":!1,"show-selected-site":!0},null,8,["model-value","show-all-sites-item"])])])]),Object(s["createElementVNode"])("div",f,[Object(s["createElementVNode"])("div",S,[e.isSuperUser?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",E,Object(s["toDisplayString"])(e.translate("CustomReports_ReportAllWebsitesHelp")),1)):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",N,Object(s["toDisplayString"])(e.translate("CustomReports_ReportAllWebsitesNonSuperUserHelp")),1))])]),"all"!==e.report.site.id&&"0"!==e.report.site.id&&0!==e.report.site.id?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",k,[e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",V,[Object(s["createElementVNode"])("span",w,Object(s["toDisplayString"])(e.translate("CustomReports_SelectMeasurablesMatchingSearch")),1),D,Object(s["withDirectives"])(Object(s["createElementVNode"])("input",{class:"control_text customReportSearchMeasurablesField",type:"text",id:"websitecontains","onUpdate:modelValue":t[3]||(t[3]=t=>e.containsText=t),placeholder:e.translate("General_Search")},null,8,_),[[s["vModelText"],e.containsText]]),Object(s["createElementVNode"])("input",{style:{"margin-left":"3.5px"},disabled:!e.containsText,class:"btn customReportSearchFindMeasurables",type:"button",onClick:t[4]||(t[4]=t=>e.addSitesContaining(e.containsText)),value:e.translate("CustomReports_FindMeasurables")},null,8,M)])):Object(s["createCommentVNode"])("",!0),e.report.allowedToEdit||e.multipleSites.length?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",A,[B,Object(s["createElementVNode"])("table",U,[Object(s["createElementVNode"])("thead",null,[Object(s["createElementVNode"])("tr",null,[Object(s["createElementVNode"])("th",I,Object(s["toDisplayString"])(e.translate("General_Id")),1),Object(s["createElementVNode"])("th",L,Object(s["toDisplayString"])(e.translate("General_Name")),1),e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("th",T,Object(s["toDisplayString"])(e.translate("General_Remove")),1)):Object(s["createCommentVNode"])("",!0)])]),Object(s["createElementVNode"])("tbody",null,[Object(s["withDirectives"])(Object(s["createElementVNode"])("tr",null,[Object(s["createElementVNode"])("td",x,Object(s["toDisplayString"])(e.translate("CustomReports_NoMeasurableAssignedYet")),1)],512),[[s["vShow"],!e.multipleSites.length]]),(Object(s["openBlock"])(!0),Object(s["createElementBlock"])(s["Fragment"],null,Object(s["renderList"])(e.multipleSites,(t,o)=>Object(s["withDirectives"])((Object(s["openBlock"])(),Object(s["createElementBlock"])("tr",{key:o},[Object(s["createElementVNode"])("td",null,Object(s["toDisplayString"])(t.idsite),1),Object(s["createElementVNode"])("td",null,Object(s["toDisplayString"])(t.name),1),e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("td",P,[Object(s["createElementVNode"])("span",{class:"icon-minus table-action",onClick:o=>e.removeSite(t)},null,8,H)])):Object(s["createCommentVNode"])("",!0)])),[[s["vShow"],e.multipleSites.length>0]])),128))])])])):Object(s["createCommentVNode"])("",!0)])):Object(s["createCommentVNode"])("",!0)]),Object(s["createElementVNode"])("div",G,[Object(s["createElementVNode"])("h3",F,Object(s["toDisplayString"])(e.translate("CustomReports_ReportContent")),1)]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",q,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",W,Object(s["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlockBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(s["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",z,Object(s["toDisplayString"])(e.translate("CustomReports_WarningRequiresUnlock")),1)),Y,Q,Object(s["createElementVNode"])("input",{type:"button",class:"btn unlockReport",onClick:t[5]||(t[5]=t=>e.unlockReport()),value:e.translate("CustomReports_Unlock")},null,8,X)],512),[[s["vShow"],e.isLocked]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",J,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",K,Object(s["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(s["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",Z,Object(s["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[s["vShow"],e.isUnlocked]]),Object(s["createElementVNode"])("div",ee,[Object(s["createVNode"])(tt,{uicontrol:"radio",name:"reportType","model-value":e.report.report_type,"onUpdate:modelValue":t[6]||(t[6]=t=>e.setReportTypeHasChanged(t)),title:e.translate("CustomReports_ReportType"),disabled:!e.canEdit,options:e.reportTypes},null,8,["model-value","title","disabled","options"])]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",te,[Object(s["createElementVNode"])("div",oe,[Object(s["createElementVNode"])("label",null,Object(s["toDisplayString"])(e.translate("CustomReports_Dimensions")),1),ie,Object(s["createElementVNode"])("div",null,[(Object(s["openBlock"])(!0),Object(s["createElementBlock"])(s["Fragment"],null,Object(s["renderList"])(e.report.dimensions,(t,o)=>(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",{class:Object(s["normalizeClass"])("selectedDimension selectedDimension"+o),key:o},[Object(s["createElementVNode"])("div",re,[Object(s["createVNode"])(tt,{uicontrol:"expandable-select",name:"dimensions","model-value":t,"onUpdate:modelValue":t=>e.changeDimension(t,o),title:e.dimensionsReadable[t]||t,"full-width":!0,options:e.dimensions},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(s["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveDimension"),onClick:t=>e.removeDimension(o)},null,8,se)],2))),128)),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",ne,[Object(s["createVNode"])(tt,{uicontrol:"expandable-select",name:"dimensions","model-value":"","onUpdate:modelValue":t[7]||(t[7]=t=>{e.addDimension(t)}),title:e.translate("CustomReports_AddDimension"),"full-width":!0,options:e.dimensions},null,8,["title","options"])],512),[[s["vShow"],e.report.dimensions.length<e.maxDimensions]])])]),Object(s["createElementVNode"])("div",ae,[Object(s["createElementVNode"])("div",le,[Object(s["createElementVNode"])("span",{class:"inline-help",innerHTML:e.$sanitize(e.getDimensionsHelpText)},null,8,ce)])])],512),[[s["vShow"],"evolution"!==e.report.report_type]]),Object(s["createElementVNode"])("div",de,[Object(s["createElementVNode"])("div",pe,[Object(s["createElementVNode"])("label",null,Object(s["toDisplayString"])(e.translate("General_Metrics")),1),me,Object(s["createElementVNode"])("div",null,[(Object(s["openBlock"])(!0),Object(s["createElementBlock"])(s["Fragment"],null,Object(s["renderList"])(e.report.metrics,(t,o)=>(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",{class:Object(s["normalizeClass"])("selectedMetric selectedMetric"+o),key:o},[Object(s["createElementVNode"])("div",ue,[Object(s["createVNode"])(tt,{uicontrol:"expandable-select",name:"metrics","model-value":t,"onUpdate:modelValue":t=>e.changeMetric(t,o),title:e.metricsReadable[t]||t,"full-width":!0,options:e.metrics},null,8,["model-value","onUpdate:modelValue","title","options"])]),Object(s["createElementVNode"])("span",{class:"icon-minus",title:e.translate("CustomReports_RemoveMetric"),onClick:t=>e.removeMetric(o)},null,8,he)],2))),128)),Object(s["createElementVNode"])("div",be,[Object(s["createVNode"])(tt,{uicontrol:"expandable-select",name:"metrics","model-value":"","onUpdate:modelValue":t[8]||(t[8]=t=>{e.addMetric(t)}),title:e.translate("CustomReports_AddMetric"),"full-width":!0,options:e.metrics},null,8,["title","options"])])])]),Object(s["createElementVNode"])("div",ve,[Object(s["createElementVNode"])("div",Oe,[Object(s["createElementVNode"])("span",je,Object(s["toDisplayString"])(e.translate("CustomReports_ReportMetricsHelp")),1)])])]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",{class:"alert alert-warning",innerHTML:e.getProductRevenueDependencyMessage},null,8,ge),[[s["vShow"],e.dependencyAdded]]),Object(s["createElementVNode"])("div",Re,[Object(s["createElementVNode"])("div",ye,[Object(s["createElementVNode"])("div",null,[Object(s["createElementVNode"])("label",Ce,Object(s["toDisplayString"])(e.translate("CustomReports_Filter")),1),Object(s["createElementVNode"])("p",null,Object(s["toDisplayString"])(e.translate("CustomReports_ReportSegmentHelp")),1),Object(s["createElementVNode"])("div",null,[Object(s["createVNode"])(it,{"model-value":e.report.segment_filter,"onUpdate:modelValue":t[9]||(t[9]=t=>e.setSegmentFilterHasChanged(t)),idsite:e.report.site.id},null,8,["model-value","idsite"])])])])]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",fe,[Object(s["createElementVNode"])("div",Se,[Ee,Ne,Object(s["createVNode"])(rt,{class:"showPreviewButton",disabled:!(null!==(o=e.report.metrics)&&void 0!==o&&o.length)||!(null!==(i=e.report.dimensions)&&void 0!==i&&i.length),onConfirm:t[10]||(t[10]=t=>e.showPreview()),value:e.translate("CustomReports_PreviewReport")},null,8,["disabled","value"])])],512),[[s["vShow"],"table"===e.report.report_type]]),Object(s["createElementVNode"])("div",ke,[Object(s["createVNode"])(tt,{uicontrol:"select",name:"reportCategories","model-value":e.report.category.id,"onUpdate:modelValue":t[11]||(t[11]=t=>{e.report.category.id=t,e.setValueHasChanged()}),title:e.translate("CustomReports_ReportCategory"),disabled:!e.canEdit,options:e.categories,introduction:e.translate("CustomReports_ReportPage"),"inline-help":e.translate("CustomReports_ReportCategoryHelp")},null,8,["model-value","title","disabled","options","introduction","inline-help"])]),Object(s["createElementVNode"])("div",Ve,[Object(s["createVNode"])(tt,{uicontrol:"select",name:"reportSubcategories","model-value":null===(r=e.report.subcategory)||void 0===r?void 0:r.id,"onUpdate:modelValue":t[12]||(t[12]=t=>{e.setSubcategory(t),e.setValueHasChanged()}),title:e.translate("CustomReports_ReportSubcategory"),disabled:!e.canEdit,options:e.subcategories[e.report.category.id],"inline-help":e.translate("CustomReports_ReportSubcategoryHelp")},null,8,["model-value","title","disabled","options","inline-help"])]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",we,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",De,Object(s["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLostBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(s["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",_e,Object(s["toDisplayString"])(e.translate("CustomReports_WarningOnUpdateReportMightGetLost")),1))],512),[[s["vShow"],e.isUnlocked]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("div",Me,[e.multipleSites.length&&!e.report.allowedToEdit?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",Ae,Object(s["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")),1)):(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",Be,Object(s["toDisplayString"])(e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")),1))],512),[[s["vShow"],!e.canEdit]]),e.childReports.length?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",Ue,[Object(s["createElementVNode"])("h3",{class:"col s12",textContent:Object(s["toDisplayString"])(e.translate("CustomReports_OrderSubCategoryReports"))},null,8,Ie),Object(s["createElementVNode"])("div",Le,[Object(s["createElementVNode"])("ul",Te,[(Object(s["openBlock"])(!0),Object(s["createElementBlock"])(s["Fragment"],null,Object(s["renderList"])(e.childReports,e=>(Object(s["openBlock"])(),Object(s["createElementBlock"])("li",{key:e.idcustomreport,"data-id":e.idcustomreport},[Pe,Object(s["createTextVNode"])(Object(s["toDisplayString"])(e.name),1)],8,xe))),128))])]),Object(s["createElementVNode"])("div",He,[Object(s["createElementVNode"])("div",Ge,[Object(s["createElementVNode"])("div",{class:"form-description",textContent:Object(s["toDisplayString"])(e.translate("CustomReports_OrderSubCategoryReportsDescription"))},null,8,Fe)])])])):Object(s["createCommentVNode"])("",!0),Object(s["withDirectives"])(Object(s["createVNode"])(rt,{class:"createButton",onConfirm:t[13]||(t[13]=t=>e.edit?e.updateReport():e.createReport()),disabled:e.isUpdating||!e.isDirty,saving:e.isUpdating,value:e.saveButtonText},null,8,["disabled","saving","value"]),[[s["vShow"],e.canEdit]]),Object(s["createElementVNode"])("div",qe,[Object(s["createElementVNode"])("a",{onClick:t[14]||(t[14]=t=>e.cancel())},Object(s["toDisplayString"])(e.translate("General_Cancel")),1)])])],32),Object(s["createElementVNode"])("div",$e,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(s["openBlock"])(),Object(s["createElementBlock"])("h2",We,Object(s["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReportBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(s["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("h2",ze,Object(s["toDisplayString"])(e.translate("CustomReports_ConfirmUnlockReport")),1)),Object(s["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Ye),Object(s["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Qe)],512),Object(s["createElementVNode"])("div",Xe,[e.browserArchivingDisabled&&e.reArchiveLastN?(Object(s["openBlock"])(),Object(s["createElementBlock"])("h2",Je,Object(s["toDisplayString"])(e.translate("CustomReports_InfoReportIsLockedBrowserArchivingDisabled",e.reArchiveLastN)),1)):Object(s["createCommentVNode"])("",!0),e.browserArchivingDisabled&&e.reArchiveLastN?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("h2",Ke,Object(s["toDisplayString"])(e.translate("CustomReports_InfoReportIsLocked")),1)),Object(s["createElementVNode"])("input",{role:"unlock",type:"button",value:e.translate("CustomReports_Unlock")},null,8,Ze),Object(s["createElementVNode"])("input",{role:"ok",type:"button",value:e.translate("General_Cancel")},null,8,et)],512)]}),_:1},8,["content-title"])}var ot=o("19dc"),it=o("a5a2"),rt=o("f06f");function st(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function nt(e){return[...new Set(e)].filter(e=>!!e)}function at(e,t,o){const i=[];return e.forEach(e=>{e[t].forEach(t=>{i.push(Object.assign({group:e.category,key:t.uniqueId,value:t.name,tooltip:t.description||void 0},o?{[o]:t[o]}:{}))})}),i}const lt={key:"",value:""};class ct{constructor(){st(this,"privateState",Object(s["reactive"])({reports:[],reportTypesReadable:{},dimensionsReadable:{},metricsReadable:{},categories:[],subcategories:{},isLoading:!1,isUpdating:!1,allMetrics:[],allDimensions:[]})),st(this,"state",Object(s["computed"])(()=>Object(s["readonly"])(this.privateState))),st(this,"fetchPromise",null),st(this,"availableReportTypesPromise",null),st(this,"dimensionsPromise",null),st(this,"dimensionsIdsiteLoaded",0),st(this,"metricsPromise",null),st(this,"metricsIdsiteLoaded",0),st(this,"categoriesPromise",null),st(this,"categoriesIdsiteLoaded",null)}reload(){return this.privateState.reports=[],this.fetchPromise=null,this.fetchReports()}cleanupSegmentDefinition(e){let t=e;return t=t.replace("'","%27"),t=t.replace("&","%26"),t}getAvailableReportTypes(){return this.availableReportTypesPromise||(this.availableReportTypesPromise=ot["AjaxHelper"].fetch({method:"CustomReports.getAvailableReportTypes",filter_limit:"-1"}).then(e=>{const t={};e.forEach(e=>{t[e.key]=e.value}),this.privateState.reportTypesReadable=t})),this.availableReportTypesPromise.then(()=>this.state.value.reportTypesReadable)}getAvailableDimensions(e){return this.dimensionsPromise&&this.dimensionsIdsiteLoaded===e||(this.dimensionsIdsiteLoaded=e,this.dimensionsPromise=ot["AjaxHelper"].fetch({method:"CustomReports.getAvailableDimensions",filter_limit:"-1",idSite:e}).then(e=>{const t={};e.forEach(e=>{e.dimensions.forEach(e=>{t[e.uniqueId]=e.name})}),this.privateState.dimensionsReadable=t,this.privateState.allDimensions=at(e,"dimensions","sqlSegment")})),this.dimensionsPromise.then(()=>this.state.value.dimensionsReadable)}getAvailableMetrics(e){return this.metricsPromise&&this.metricsIdsiteLoaded===e||(this.metricsIdsiteLoaded=e,this.metricsPromise=ot["AjaxHelper"].fetch({method:"CustomReports.getAvailableMetrics",filter_limit:"-1",idSite:e}).then(e=>{const t={};e.forEach(e=>{e.metrics.forEach(e=>{t[e.uniqueId]=e.name})}),this.privateState.metricsReadable=t,this.privateState.allMetrics=at(e,"metrics")})),this.metricsPromise.then(()=>this.state.value.metricsReadable)}getAvailableCategories(e){const t=e&&"all"!==e?e:ot["Matomo"].idSite;return this.categoriesPromise&&this.categoriesIdsiteLoaded===e||(this.categoriesPromise=ot["AjaxHelper"].fetch({method:"CustomReports.getAvailableCategories",filter_limit:"-1",idSite:t}).then(e=>{const t=[],o={};e.forEach(e=>{t.push({key:e.uniqueId,value:e.name}),e.subcategories.forEach(t=>{o[e.uniqueId]=o[e.uniqueId]||[lt],o[e.uniqueId].push({key:t.uniqueId,value:t.name})})}),this.privateState.categories=t,this.privateState.subcategories=o})),this.categoriesPromise}fetchReports(){return this.fetchPromise||(this.fetchPromise=ot["AjaxHelper"].fetch({method:"CustomReports.getConfiguredReports",filter_limit:"-1"})),this.privateState.isLoading=!0,this.privateState.reports=[],this.fetchPromise.then(e=>(this.privateState.reports=e.map(e=>{var t,o;let i=void 0;return i=null!==e&&void 0!==e&&null!==(t=e.subcategory)&&void 0!==t&&t.id?e.subcategory.id:"CustomReports_CustomReports"===(null===e||void 0===e||null===(o=e.category)||void 0===o?void 0:o.id)?e.idcustomreport:e.name,Object.assign(Object.assign({},e),{},{linkIdSite:e.idsite?e.idsite:ot["Matomo"].idSite,subcategoryLink:i})}),this.state.value.reports)).finally(()=>{this.privateState.isLoading=!1})}findReport(e,t){const o=this.state.value.reports.find(t=>parseInt(""+t.idcustomreport,10)===e);return o&&!t?Promise.resolve(o):(this.privateState.isLoading=!0,ot["AjaxHelper"].fetch({idCustomReport:e,method:"CustomReports.getConfiguredReport"}).finally(()=>{this.privateState.isLoading=!1}))}deleteReport(e,t){return this.privateState.isUpdating=!0,this.privateState.reports=[],ot["AjaxHelper"].fetch({idCustomReport:e,idSite:""+t,method:"CustomReports.deleteCustomReport"},{withTokenInUrl:!0}).then(()=>({type:"success"})).catch(e=>({type:"error",message:e.message||e})).finally(()=>{this.privateState.isUpdating=!1})}pauseReport(e,t){return this.privateState.isUpdating=!0,this.privateState.reports=[],ot["AjaxHelper"].fetch({idCustomReport:e,idSite:""+t,method:"CustomReports.pauseCustomReport"},{withTokenInUrl:!0}).then(()=>({type:"success"})).catch(e=>({type:"error",message:e.message||e})).finally(()=>{this.privateState.isUpdating=!1})}resumeReport(e,t){return this.privateState.isUpdating=!0,this.privateState.reports=[],ot["AjaxHelper"].fetch({idCustomReport:e,idSite:""+t,method:"CustomReports.resumeCustomReport"},{withTokenInUrl:!0}).then(()=>({type:"success"})).catch(e=>({type:"error",message:e.message||e})).finally(()=>{this.privateState.isUpdating=!1})}createOrUpdateReport(e,t,o,i){var r,s;return this.privateState.isUpdating=!0,ot["AjaxHelper"].post({method:t,idCustomReport:e.idcustomreport,reportType:e.report_type,name:e.name.trim(),description:e.description.trim(),segmentFilter:encodeURIComponent(e.segment_filter),categoryId:null===(r=e.category)||void 0===r?void 0:r.id,subcategoryId:null===(s=e.subcategory)||void 0===s?void 0:s.id,idSite:e.site.id,subCategoryReportIds:o,multipleIdSites:i},{dimensionIds:nt(e.dimensions),metricIds:nt(e.metrics)},{withTokenInUrl:!0}).then(e=>({type:"success",response:e})).catch(e=>({type:"error",message:e.message||e})).finally(()=>{this.privateState.isUpdating=!1})}}var dt=new ct;const pt="reportsmanagement",mt="reportsmanagementProductMetric";function ut(e){return[...new Set(e)].filter(e=>!!e)}function ht(){return{dimensions:[],site:{id:ot["Matomo"].idSite,name:ot["Matomo"].currentSiteName},category:{}}}var bt=Object(s["defineComponent"])({props:{idCustomReport:Number,browserArchivingDisabled:Boolean,reArchiveLastN:Number,maxDimensions:Number,isCloud:Boolean},components:{ContentBlock:ot["ContentBlock"],Field:it["Field"],SiteSelector:ot["SiteSelector"],SegmentGenerator:rt["SegmentGenerator"],SaveButton:it["SaveButton"]},data(){return{isDirty:!1,report:ht(),isLocked:!1,isUnlocked:!1,canEdit:!0,dependencyAdded:!1,childReports:[],childReportIds:[],containsText:"",multipleSites:[],multipleIdSites:[]}},created(){dt.getAvailableReportTypes(),this.init()},watch:{idCustomReport(e){null!==e&&this.init()}},methods:{initReportOptions(){const e=parseInt(""+this.report.site.id,10)||"all";dt.getAvailableDimensions(e),dt.getAvailableMetrics(e),dt.getAvailableCategories(e)},doUnlock(){this.isLocked=!1,this.isUnlocked=!0},confirmReportIsLocked(e){ot["Matomo"].helper.modalConfirm(this.$refs.infoReportIsLocked,{unlock:()=>{this.doUnlock(),e&&e()}})},removeAnyReportNotification(){ot["NotificationsStore"].remove(pt),ot["NotificationsStore"].remove(mt),ot["NotificationsStore"].remove("ajaxHelper")},showApiErrorMessage(e,t){if(e&&t){this.removeAnyReportNotification();const o=document.createElement("textarea");o.innerHTML=e,this.showNotification(o.value,t,"toast")}},showNotification(e,t,o=null){const i=ot["NotificationsStore"].show({message:e,context:t,id:pt,type:null!==o&&void 0!==o?o:"transient",prepend:!0});setTimeout(()=>{ot["NotificationsStore"].scrollToNotification(i)},100)},showProductMetricNotification(e,t){const o=ot["NotificationsStore"].show({message:e,context:"warning",id:mt,type:"transient"});t&&setTimeout(()=>{ot["NotificationsStore"].scrollToNotification(o)},100)},showErrorFieldNotProvidedNotification(e){const t=Object(ot["translate"])("CustomReports_ErrorXNotProvided",[e]);this.showNotification(t,"error")},init(){const{idCustomReport:e}=this;this.canEdit=!0,this.report=ht(),ot["Matomo"].helper.lazyScrollToContent(),this.edit&&e?dt.findReport(e,!0).then(e=>{var t;if(!e)return;this.report=Object(ot["clone"])(e),this.isLocked=!0,this.isUnlocked=!1,this.canEdit=!0,this.childReports=null!==(t=this.report.child_reports)&&void 0!==t?t:[],this.report.multipleIdSites&&this.report.multipleIdSites.length&&"all"!==this.report.site.id&&"0"!==this.report.site.id&&0!==this.report.site.id&&(this.multipleSites=this.report.multipleIdSites,this.report.allowedToEdit||(this.canEdit=!1,this.isLocked=!1)),this.childReports.length&&Object.values(this.childReports).forEach(e=>{this.childReportIds.push(e.idcustomreport)}),$(document).ready(()=>{$("#childReports").sortable({connectWith:"#childReports",update:()=>{this.isDirty=!0;const e=$("#childReports li");this.childReportIds=[],e.each((e,t)=>{t.dataset.id&&this.childReportIds.push(t.dataset.id)})}})});let o=this.report.idsite;0!==o&&"0"!==o&&"all"!==o||(o="all",this.isSuperUser||(this.canEdit=!1,this.isLocked=!1)),this.report.site={id:o,name:this.report.site.name},this.isDirty=!1,this.initReportOptions()}):this.create&&(this.report={idsite:ot["Matomo"].idSite,site:{id:ot["Matomo"].idSite,name:ot["Matomo"].currentSiteName||ot["Matomo"].siteName},name:"",description:"",dimensions:[],metrics:["nb_visits"],report_type:"table",category:{id:"CustomReports_CustomReports"},subcategory:null,segment_filter:"",child_reports:[],allowedToEdit:!0},this.isLocked=!1,this.canEdit=!0,this.isDirty=!1,this.initReportOptions())},cancel(){const e=Object.assign({},ot["MatomoUrl"].hashParsed.value);delete e.idCustomReport,ot["MatomoUrl"].updateHash(e)},unlockReport(){this.report&&this.isLocked&&ot["Matomo"].helper.modalConfirm(this.$refs.confirmUnlockReport,{yes:()=>{this.doUnlock()}})},createReport(){const e="CustomReports.addCustomReport";this.removeAnyReportNotification(),this.checkRequiredFieldsAreSet()&&(this.multipleIdSites=[],this.multipleSites&&this.multipleSites.length&&"all"!==this.report.site.id&&"0"!==this.report.site.id&&0!==this.report.site.id&&(this.multipleIdSites.push(ot["Matomo"].idSite),this.multipleSites.forEach(e=>{const t=e.idsite;this.multipleIdSites.includes(t)||this.multipleIdSites.push(t)})),this.multipleIdSites&&this.multipleIdSites.length&&(this.report.site.id=ot["Matomo"].idSite),dt.createOrUpdateReport(this.report,e,this.childReportIds,this.multipleIdSites).then(e=>{var t,o;if(!e||"error"===e.type||!e.response)return void this.showApiErrorMessage(null!==(t=e.message)&&void 0!==t?t:"",null!==(o=e.type)&&void 0!==o?o:"error");this.isDirty=!1;const i=e.response.value;if(this.report.site){const e=this.report.site.id;if(e&&"all"!==e&&""+e!==""+ot["Matomo"].idSite)return void ot["MatomoUrl"].updateUrl(Object.assign(Object.assign({},ot["MatomoUrl"].urlParsed.value),{},{idSite:e}),Object.assign(Object.assign({},ot["MatomoUrl"].hashParsed.value),{},{idCustomReport:i}))}dt.reload().then(()=>{ot["Matomo"].helper.isReportingPage()&&ot["Matomo"].postEvent("updateReportingMenu"),ot["MatomoUrl"].updateHash(Object.assign(Object.assign({},ot["MatomoUrl"].hashParsed.value),{},{idCustomReport:i})),setTimeout(()=>{this.showNotification(Object(ot["translate"])("CustomReports_ReportCreated"),e.type)},200)})}))},showPreview(){var e,t,o;if(!this.isProductRevenueDependencyMet(!0))return;const i=null!==(e=this.report.site)&&void 0!==e&&e.id&&"all"!==this.report.site.id?this.report.site.id:ot["Matomo"].idSite,r=(null===(t=this.report.dimensions)||void 0===t?void 0:t.length)&&this.report.report_type&&"evolution"!==this.report.report_type,s=r?this.report.dimensions.join(","):void 0,n=!(null===(o=this.report.metrics)||void 0===o||!o.length),a=n?this.report.metrics.join(","):void 0,l=ot["MatomoUrl"].stringify({module:"CustomReports",action:"previewReport",period:"day",date:"today",idSite:i,report_type:this.report.report_type,dimensions:s,metrics:a,segment:this.report.segment_filter||void 0}),c=Object(ot["translate"])("CustomReports_Preview");window.Piwik_Popover.createPopupAndLoadUrl(l,c,"customReportPreview")},setValueHasChanged(){this.isDirty=!0},addDimension(e){this.report&&e&&(this.isLocked?this.confirmReportIsLocked(()=>{this.addDimension(e)}):(this.report.dimensions||(this.report.dimensions=[]),this.report.dimensions=[...this.report.dimensions,e],this.setValueHasChanged()))},changeDimension(e,t){var o;this.report&&e&&(this.isLocked?this.confirmReportIsLocked(()=>{this.changeDimension(e,t)}):null!==(o=this.report.dimensions)&&void 0!==o&&o[t]&&(this.report.dimensions=[...this.report.dimensions],this.report.dimensions[t]=e,this.setValueHasChanged()))},changeMetric(e,t){var o;this.dependencyAdded=!1,this.report&&e&&(this.isLocked?this.confirmReportIsLocked(()=>{this.changeMetric(e,t)}):null!==(o=this.report.metrics)&&void 0!==o&&o[t]&&(this.report.metrics=[...this.report.metrics],this.report.metrics[t]=e,this.setValueHasChanged(),this.addMetricIfMissingDependency(e)))},setWebsiteChanged(e){this.setValueHasChanged(),this.initReportOptions(),"all"===this.report.site.id||"0"===this.report.site.id||0===this.report.site.id?this.multipleSites=[]:this.report.allowedToEdit&&!this.isSiteIncludedAlready(""+e.id)&&this.multipleSites&&this.multipleSites.push({idsite:e.id,name:e.name})},removeDimension(e){this.isLocked?this.confirmReportIsLocked(()=>{this.removeDimension(e)}):(window.$('div.ui-tooltip[role="tooltip"]:not([style*="display: none"])').remove(),e>-1&&(this.report.dimensions=[...this.report.dimensions],this.report.dimensions.splice(e,1),this.setValueHasChanged()))},addMetric(e){this.dependencyAdded=!1,this.report&&e&&(this.report.metrics||(this.report.metrics=[]),this.isLocked?this.confirmReportIsLocked(()=>{this.addMetric(e)}):(this.report.metrics=[...this.report.metrics,e],this.setValueHasChanged(),this.addMetricIfMissingDependency(e)))},addMetricIfMissingDependency(e){if(!["sum_product_revenue","avg_product_revenue"].includes(e)||this.doesReportIncludeProductQuantityMetric())return;const t="avg_product_revenue"===e?"avg_ecommerce_productquantity":"sum_ecommerce_productquantity";this.addMetric(t),this.dependencyAdded=!0},removeMetric(e){this.dependencyAdded=!1,this.isLocked?this.confirmReportIsLocked(()=>{this.removeMetric(e)}):(window.$('div.ui-tooltip[role="tooltip"]:not([style*="display: none"])').remove(),e>-1&&(this.report.metrics=[...this.report.metrics],this.report.metrics.splice(e,1),this.setValueHasChanged()))},setReportTypeHasChanged(e){this.report&&this.isLocked?e!==this.report.report_type&&this.confirmReportIsLocked(()=>{this.report.report_type=e,this.setValueHasChanged()}):(this.report.report_type=e,this.setValueHasChanged())},setSegmentFilterHasChanged(e){this.report&&this.isLocked?e!==this.report.segment_filter&&this.confirmReportIsLocked(()=>{this.report.segment_filter=e,this.setValueHasChanged()}):(this.report.segment_filter=e,this.setValueHasChanged())},updateReport(){if(this.removeAnyReportNotification(),!this.checkRequiredFieldsAreSet())return;this.multipleIdSites=[],this.multipleSites&&this.multipleSites.length&&"all"!==this.report.site.id&&"0"!==this.report.site.id&&0!==this.report.site.id&&(this.multipleIdSites.push(ot["Matomo"].idSite),this.multipleSites.forEach(e=>{const t=e.idsite;this.multipleIdSites.includes(t)||this.multipleIdSites.push(t)}));const e="CustomReports.updateCustomReport";this.multipleIdSites&&this.multipleIdSites.length&&(this.report.site.id=ot["Matomo"].idSite),dt.createOrUpdateReport(this.report,e,this.childReportIds,this.multipleIdSites).then(e=>{var t,o;if(!e||"error"===e.type)return void this.showApiErrorMessage(null!==(t=e.message)&&void 0!==t?t:"",null!==(o=e.type)&&void 0!==o?o:"error");const i=this.report.site.id;this.isDirty=!1,this.canEdit=!0,i&&"all"!==i&&""+i!==""+ot["Matomo"].idSite?ot["MatomoUrl"].updateUrl(Object.assign(Object.assign({},ot["MatomoUrl"].urlParsed.value),{},{idSite:i}),Object.assign({},ot["MatomoUrl"].hashParsed.value)):(dt.reload().then(()=>{this.init()}),this.showNotification(Object(ot["translate"])("CustomReports_ReportUpdated"),e.type))})},checkRequiredFieldsAreSet(){var e,t;if(!this.report.name){const e=Object(ot["translate"])("General_Name");return this.showErrorFieldNotProvidedNotification(e),!1}if("evolution"!==this.report.report_type&&(null===(t=this.report.dimensions)||void 0===t||!t.length||!ut(this.report.dimensions).length)){const e=Object(ot["translate"])("CustomReports_ErrorMissingDimension");return this.showNotification(e,"error"),!1}if(null===(e=this.report.metrics)||void 0===e||!e.length||!ut(this.report.metrics).length){const e=Object(ot["translate"])("CustomReports_ErrorMissingMetric");return this.showNotification(e,"error"),!1}return this.isProductRevenueDependencyMet(!1),!0},setSubcategory(e){this.report.subcategory=this.report.subcategory||{id:""},this.report.subcategory.id=e},isProductRevenueDependencyMet(e){const t=Object(ot["externalLink"])("https://matomo.org/faq/custom-reports/why-is-there-an-error-when-i-try-to-run-a-custom-report-with-the-product-revenue-metric/"),o=Object(ot["translate"])("CustomReports_WarningProductRevenueMetricDependency",t,"</a>");return this.report.metrics.includes("sum_product_revenue")&&!this.doesReportIncludeProductQuantityMetric()?(this.addMetric("sum_ecommerce_productquantity"),this.showProductMetricNotification(o,e),!1):!(this.report.metrics.includes("avg_product_revenue")&&!this.doesReportIncludeProductQuantityMetric())||(this.addMetric("avg_ecommerce_productquantity"),this.showProductMetricNotification(o,e),!1)},doesReportIncludeProductQuantityMetric(){return this.report.metrics.includes("sum_ecommerce_productquantity")||this.report.metrics.includes("avg_ecommerce_productquantity")},isSiteIncludedAlready(e){return!(!this.multipleSites||!this.multipleSites.length)&&this.multipleSites.some(t=>""+t.idsite===""+e)},removeSite(e){this.multipleSites&&(this.isDirty=!0,this.multipleSites=this.multipleSites.filter(t=>t.idsite!==e.idsite))},addSitesContaining(e){if(!e)return;const t=`"${ot["Matomo"].helper.escape(ot["Matomo"].helper.htmlEntities(e))}"`;ot["AjaxHelper"].fetch({method:"SitesManager.getSitesWithAdminAccess",pattern:e,filter_limit:-1}).then(e=>{if(!e||!e.length){const e=`<div>\n            <h2>${Object(ot["translate"])("CustomReports_MatchingSearchNotFound",t)}</h2>\n            <input role="ok" type="button" value="${Object(ot["translate"])("General_Ok")}"/>\n          </div>`;return void ot["Matomo"].helper.modalConfirm(e)}const o=[],i=[];e.forEach(e=>{const t=window.vueSanitize(ot["Matomo"].helper.htmlEntities(e.name)),r=`${t} (id ${parseInt(""+e.idsite,10)})<br />`;this.isSiteIncludedAlready(""+e.idsite)?i.push(r):o.push(r)});let r=Object(ot["translate"])("CustomReports_MatchingSearchConfirmTitle",o.length);if(i.length){const e=Object(ot["translate"])("CustomReports_MatchingSearchConfirmTitleAlreadyAdded",i.length);r+=` (${e})`}let s=`<div><h2>${r}</h2><p>\n          ${Object(ot["translate"])("CustomReports_MatchingSearchMatchedAdd",o.length,t)}:\n          <br /><br />`;if(s+=o.join(""),i.length){const e=Object(ot["translate"])("CustomReports_MatchingSearchMatchedAlreadyAdded",i.length,t);s+=`<br />${e}:<br /><br />${i.join("")}`}s+=`</p><input role="yes" type="button" value="${Object(ot["translate"])("General_Yes")}"/>\n          <input role="no" type="button" value="${Object(ot["translate"])("General_No")}"/>\n          </div>`,ot["Matomo"].helper.modalConfirm(s,{yes:()=>{e.forEach(e=>{this.multipleSites&&(this.isSiteIncludedAlready(""+e.idsite)||(this.isDirty=!0,this.multipleSites.push({idsite:e.idsite,name:e.name})))}),this.containsText=""}})})}},computed:{isSuperUser(){return!!ot["Matomo"].hasSuperUserAccess},allMetrics(){return dt.state.value.allMetrics},metrics(){var e;const t=["pageviews_with_generation_time","avg_page_generation_time","max_actions_pagegenerationtime","sum_actions_pagegenerationtime"],o=((null===(e=this.report)||void 0===e?void 0:e.metrics)||[]).some(e=>t.indexOf(e)>=0),i=!o;return this.allMetrics.filter(e=>!!e&&!(i&&t.indexOf(e.key)>=0))},allDimensions(){return dt.state.value.allDimensions},reportTypes(){return dt.state.value.reportTypesReadable},create(){return!this.idCustomReport},edit(){return!this.create},editTitle(){return this.create?"CustomReports_CreateNewReport":"CustomReports_EditReport"},contentTitle(){return Object(ot["translate"])(this.editTitle,this.report.name?`"${this.report.name}"`:"")},categories(){return dt.state.value.categories},subcategories(){return dt.state.value.subcategories},dimensions(){var e;const t=[...this.allDimensions];if(null===(e=this.report)||void 0===e||!e.dimensions)return t;const o=-1!==this.report.dimensions.indexOf("Actions.PageGenerationTime"),i=this.report.dimensions.map(e=>{var o;return null===(o=t.find(t=>t.key===e))||void 0===o?void 0:o.sqlSegment}).filter(e=>!!e);for(let r=0;r<t.length;r+=1){const e=t[r];if(!o&&"Actions.PageGenerationTime"===e.key){t.splice(r,1),r-=1;break}e.sqlSegment&&i.indexOf(e.sqlSegment)>-1&&-1===this.report.dimensions.indexOf(e.key)&&(t.splice(r,1),r-=1)}return t},isLoading(){return dt.state.value.isLoading},isUpdating(){return dt.state.value.isUpdating},dimensionsReadable(){return dt.state.value.dimensionsReadable},metricsReadable(){return dt.state.value.metricsReadable},saveButtonText(){return this.edit?Object(ot["translate"])("CoreUpdater_UpdateTitle"):Object(ot["translate"])("CustomReports_CreateNewReport")},getProductRevenueDependencyMessage(){const e=Object(ot["externalLink"])("https://matomo.org/faq/custom-reports/why-is-there-an-error-when-i-try-to-run-a-custom-report-with-the-product-revenue-metric/");return Object(ot["translate"])("CustomReports_WarningProductRevenueMetricDependency",e,"</a>")},getPausedStateAdminMessage(){const e="?"+ot["MatomoUrl"].stringify(Object.assign(Object.assign({},ot["MatomoUrl"].urlParsed.value),{},{module:"CustomReports",action:"manage"}));return Object(ot["translate"])("CustomReports_ReportInPausedStateAdmin",`<a href="${e}" target="_blank" rel="noreferrer noopener">`,"</a>")},getDimensionsHelpText(){const e=Object(ot["translate"])("CustomReports_ReportDimensionsHelpNew"),t=this.getDimensionsHelpTextExtended;return t?`${e}<br><br>${t}`:e},getDimensionsHelpTextExtended(){if(this.isCloud)return"";const e=Object(ot["externalLink"])("https://matomo.org/faq/custom-reports/faq_25655/");return Object(ot["translate"])("CustomReports_ReportDimensionsHelpExtended",e,"</a>")}}});bt.render=tt;var vt=bt;const Ot={class:"reportSearchFilter"},jt={class:"index"},gt={class:"name"},Rt={class:"description"},yt={class:"reportType"},Ct={class:"reportCategory"},ft={class:"action"},St={colspan:"7"},Et={class:"loadingPiwik"},Nt=Object(s["createElementVNode"])("img",{src:"plugins/Morpheus/images/loading-blue.gif"},null,-1),kt={colspan:"7"},Vt=["id"],wt={class:"index"},Dt={class:"name"},_t=["title"],Mt=["title"],At=["title"],Bt=["title"],Ut=["title"],It={class:"reportType"},Lt=["title"],Tt={key:0},xt=["title","onClick"],Pt=["title","onClick"],Ht=["title","onClick"],Gt=["title","href"],Ft={key:0},qt=["title","onClick"],$t={class:"tableActionBar"},Wt=Object(s["createElementVNode"])("span",{class:"icon-add"},null,-1),zt={class:"ui-confirm",ref:"confirmDeleteReport"},Yt=["value"],Qt=["value"],Xt={class:"ui-confirm",ref:"confirmPauseReport"},Jt=["value"],Kt=["value"],Zt={class:"ui-confirm",ref:"confirmResumeReport"},eo=["value"],to=["value"];function oo(e,t,o,i,r,n){const a=Object(s["resolveComponent"])("Field"),l=Object(s["resolveComponent"])("EntityDuplicatorAction"),c=Object(s["resolveComponent"])("ContentBlock"),d=Object(s["resolveComponent"])("EntityDuplicatorModal"),p=Object(s["resolveDirective"])("content-table");return Object(s["openBlock"])(),Object(s["createElementBlock"])(s["Fragment"],null,[Object(s["createElementVNode"])("div",null,[Object(s["createVNode"])(c,{"content-title":e.translate("CustomReports_ManageReports"),feature:e.translate("CustomReports_ManageReports")},{default:Object(s["withCtx"])(()=>[Object(s["createElementVNode"])("p",null,Object(s["toDisplayString"])(e.translate("CustomReports_CustomReportIntroduction")),1),Object(s["createElementVNode"])("div",Ot,[Object(s["withDirectives"])(Object(s["createVNode"])(a,{uicontrol:"text",name:"reportSearch",title:e.translate("General_Search"),modelValue:e.searchFilter,"onUpdate:modelValue":t[0]||(t[0]=t=>e.searchFilter=t)},null,8,["title","modelValue"]),[[s["vShow"],e.reports.length>0]])]),Object(s["withDirectives"])((Object(s["openBlock"])(),Object(s["createElementBlock"])("table",null,[Object(s["createElementVNode"])("thead",null,[Object(s["createElementVNode"])("tr",null,[Object(s["createElementVNode"])("th",jt,Object(s["toDisplayString"])(e.translate("General_Id")),1),Object(s["createElementVNode"])("th",gt,Object(s["toDisplayString"])(e.translate("General_Name")),1),Object(s["createElementVNode"])("th",Rt,Object(s["toDisplayString"])(e.translate("General_Description")),1),Object(s["createElementVNode"])("th",yt,Object(s["toDisplayString"])(e.translate("CustomReports_Type")),1),Object(s["createElementVNode"])("th",Ct,Object(s["toDisplayString"])(e.translate("CustomReports_Category")),1),Object(s["createElementVNode"])("th",ft,Object(s["toDisplayString"])(e.translate("General_Actions")),1)])]),Object(s["createElementVNode"])("tbody",null,[Object(s["withDirectives"])(Object(s["createElementVNode"])("tr",null,[Object(s["createElementVNode"])("td",St,[Object(s["createElementVNode"])("span",Et,[Nt,Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(e.translate("General_LoadingData")),1)])])],512),[[s["vShow"],e.isLoading||e.isUpdating]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("tr",null,[Object(s["createElementVNode"])("td",kt,Object(s["toDisplayString"])(e.translate("CustomReports_NoCustomReportsFound")),1)],512),[[s["vShow"],!e.isLoading&&0==e.reports.length]]),(Object(s["openBlock"])(!0),Object(s["createElementBlock"])(s["Fragment"],null,Object(s["renderList"])(e.sortedReports,t=>{var o;return Object(s["openBlock"])(),Object(s["createElementBlock"])("tr",{id:"report"+t.idcustomreport,class:"customReports",key:t.idcustomreport},[Object(s["createElementVNode"])("td",wt,Object(s["toDisplayString"])(t.idcustomreport),1),Object(s["createElementVNode"])("td",Dt,[Object(s["createTextVNode"])(Object(s["toDisplayString"])(t.name)+" ",1),Object(s["withDirectives"])(Object(s["createElementVNode"])("span",{class:"icon-locked",title:e.translate("CustomReports_ReportEditNotAllowedAllWebsitesUpdated")},null,8,_t),[[s["vShow"],!t.idsite&&!e.isSuperUser]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("span",{class:"icon-info2",title:e.translate("CustomReports_ReportAvailableToAllWebsites")},null,8,Mt),[[s["vShow"],!t.idsite&&e.isSuperUser]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("span",{class:"icon-locked",title:e.translate("CustomReports_ReportEditNotAllowedMultipleWebsitesAccessIssue")},null,8,At),[[s["vShow"],!t.allowedToEdit&&e.isMultiSiteReport(t)]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("span",{class:"icon-info2",title:e.translate("CustomReports_ReportAvailableToMultipleWebsites")},null,8,Bt),[[s["vShow"],t.allowedToEdit&&e.isMultiSiteReport(t)]])]),Object(s["createElementVNode"])("td",{class:"description",title:e.htmlEntities(t.description)},Object(s["toDisplayString"])(e.truncate(t.description.trim(),60)),9,Ut),Object(s["createElementVNode"])("td",It,Object(s["toDisplayString"])(e.reportTypesReadable[t.report_type]),1),Object(s["createElementVNode"])("td",{class:"reportCategory",title:e.htmlEntities(t.category.name)},[Object(s["createTextVNode"])(Object(s["toDisplayString"])(e.truncate(t.category.name.trim(),60))+" ",1),null!==(o=t.subcategory)&&void 0!==o&&o.name?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",Tt," - "+Object(s["toDisplayString"])(e.truncate(t.subcategory.name.trim(),60)),1)):Object(s["createCommentVNode"])("",!0)],8,Lt),Object(s["createElementVNode"])("td",{class:Object(s["normalizeClass"])({action:!0,"duplicate-available":e.isEntityDuplicatorAvailable})},[Object(s["withDirectives"])(Object(s["createElementVNode"])("a",{class:"table-action icon-pause",title:e.translate("CustomReports_PauseReportInfo"),onClick:o=>e.pauseReport(t)},null,8,xt),[[s["vShow"],(t.idsite&&!e.isMultiSiteReport(t)||t.allowedToEdit)&&"active"===t.status]]),Object(s["withDirectives"])(Object(s["createElementVNode"])("a",{class:"table-action icon-play",title:e.translate("CustomReports_ResumeReportInfo"),onClick:o=>e.resumeReport(t)},null,8,Pt),[[s["vShow"],(t.idsite&&!e.isMultiSiteReport(t)||t.allowedToEdit)&&"paused"===t.status]]),Object(s["createElementVNode"])("a",{class:"table-action icon-edit",title:e.translate("CustomReports_EditReport"),onClick:o=>e.editReport(t.idcustomreport)},null,8,Ht),Object(s["createElementVNode"])("a",{target:"_blank",class:"table-action icon-show",title:e.translate("CustomReports_ViewReportInfo"),href:e.getViewReportLink(t)},null,8,Gt),e.isEntityDuplicatorAvailable&&(t.idsite&&!e.isMultiSiteReport(t)||t.allowedToEdit)?(Object(s["openBlock"])(),Object(s["createElementBlock"])("span",Ft,[Object(s["createVNode"])(l,{actionFormData:{idCustomReport:t.idcustomreport},modalStore:e.entityDuplicatorStore,isActionVisible:e.showDuplicatorAction,isActionEnabled:e.enableDuplicatorAction,tooltipTextOverrideDisabled:e.translate("CustomReports_QuotaReachedForX",e.translate("CustomReports_CustomReport"),e.translate("CustomReports_CustomReports")),extraClasses:["customreport-duplicate-action","customreport-"+t.idcustomreport]},null,8,["actionFormData","modalStore","isActionVisible","isActionEnabled","tooltipTextOverrideDisabled","extraClasses"])])):Object(s["createCommentVNode"])("",!0),Object(s["withDirectives"])(Object(s["createElementVNode"])("a",{class:"table-action icon-delete",title:e.translate("CustomReports_DeleteReportInfo"),onClick:o=>e.deleteReport(t)},null,8,qt),[[s["vShow"],t.idsite&&!e.isMultiSiteReport(t)||t.allowedToEdit]])],2)],8,Vt)}),128))])])),[[p]]),Object(s["createElementVNode"])("div",$t,[Object(s["createElementVNode"])("a",{class:"createNewReport",onClick:t[1]||(t[1]=t=>e.createReport())},[Wt,Object(s["createTextVNode"])(" "+Object(s["toDisplayString"])(e.translate("CustomReports_CreateNewReport")),1)])])]),_:1},8,["content-title","feature"]),Object(s["createElementVNode"])("div",zt,[Object(s["createElementVNode"])("h2",null,Object(s["toDisplayString"])(e.translate("CustomReports_DeleteReportConfirm")),1),Object(s["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Yt),Object(s["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Qt)],512),Object(s["createElementVNode"])("div",Xt,[Object(s["createElementVNode"])("h2",null,Object(s["toDisplayString"])(e.translate("CustomReports_PauseReportConfirm")),1),Object(s["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,Jt),Object(s["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,Kt)],512),Object(s["createElementVNode"])("div",Zt,[Object(s["createElementVNode"])("h2",null,Object(s["toDisplayString"])(e.translate("CustomReports_ResumeReportConfirm")),1),Object(s["createElementVNode"])("input",{role:"yes",type:"button",value:e.translate("General_Yes")},null,8,eo),Object(s["createElementVNode"])("input",{role:"no",type:"button",value:e.translate("General_No")},null,8,to)],512)]),Object(s["createVNode"])(d,{modalStore:e.entityDuplicatorStore},null,8,["modalStore"])],64)}
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */function io(e,t){return e&&e.length>t?e.substr(0,t-3)+"...":e}const ro=Object(ot["useExternalPluginComponent"])("CoreHome","EntityDuplicatorModal"),so=Object(ot["useExternalPluginComponent"])("CoreHome","EntityDuplicatorAction");let no=void 0;Object(ot["importPluginUmd"])("CoreHome").then(e=>{no=null===e||void 0===e?void 0:e.EntityDuplicatorStore});const ao="customreportmanagementlist";var lo=Object(s["defineComponent"])({props:{},components:{ContentBlock:ot["ContentBlock"],Field:it["Field"],EntityDuplicatorModal:ro,EntityDuplicatorAction:so},directives:{ContentTable:ot["ContentTable"]},data(){return{searchFilter:"",showDuplicatorAction:!0,enableDuplicatorAction:!1,entityDuplicatorStore:"undefined"!==typeof no?no.buildStoreInstance("CustomReports_CustomReport",{method:"CustomReports.duplicateCustomReport",requiredFields:["idSite","idDestinationSites","idCustomReport"]}):void 0}},created(){dt.getAvailableReportTypes(),dt.fetchReports()},mounted(){if(this.checkIsAddingCustomReportsAllowed(),this.entityDuplicatorStore){const e=this.entityDuplicatorStore.adapter;e.onSuccessCallback=e=>new Promise(t=>{var o,i,r;const s=null===(o=e.additionalData)||void 0===o?void 0:o.idSite;return null!==(i=e.additionalData)&&void 0!==i&&i.idSite&&Array.isArray(null===(r=e.additionalData)||void 0===r?void 0:r.idDestinationSites)&&!e.additionalData.idDestinationSites.some(e=>+e===+s)?t():dt.reload().then(()=>t())})}},methods:{createReport(){this.editReport(0)},checkIsAddingCustomReportsAllowed(){const e={isAllowed:!0};return ot["Matomo"].postEvent("CustomReports.initAddCustomReport",e),this.enableDuplicatorAction=e&&!0===e.isAllowed,!this.enableDuplicatorAction},editReport(e){ot["MatomoUrl"].updateHash(Object.assign(Object.assign({},ot["MatomoUrl"].hashParsed.value),{},{idCustomReport:e}))},pauseReport(e){ot["Matomo"].helper.modalConfirm(this.$refs.confirmPauseReport,{yes:()=>{dt.pauseReport(e.idcustomreport,e.idsite).then(e=>{e&&"error"!==e.type?(dt.reload().then(()=>{this.showNotification(this.translate("CustomReports_PausedReport"),"success")}),ot["Matomo"].postEvent("updateReportingMenu")):dt.reload()})}})},resumeReport(e){ot["Matomo"].helper.modalConfirm(this.$refs.confirmResumeReport,{yes:()=>{dt.resumeReport(e.idcustomreport,e.idsite).then(e=>{e&&"error"!==e.type?(dt.reload().then(()=>{this.showNotification(this.translate("CustomReports_ResumedReport"),"success")}),ot["Matomo"].postEvent("updateReportingMenu")):dt.reload()})}})},showNotification(e,t,o=null){const i=ot["NotificationsStore"].show({message:e,context:t,id:ao,type:null!==o?o:"toast"});setTimeout(()=>{ot["NotificationsStore"].scrollToNotification(i)},200)},deleteReport(e){ot["Matomo"].helper.modalConfirm(this.$refs.confirmDeleteReport,{yes:()=>{dt.deleteReport(e.idcustomreport,e.idsite).then(()=>{dt.reload(),ot["Matomo"].postEvent("updateReportingMenu")})}})},getViewReportLink(e){return`?${ot["MatomoUrl"].stringify({module:"CoreHome",action:"index",idSite:e.linkIdSite,period:"day",date:"yesterday"})}#?${ot["MatomoUrl"].stringify({category:e.category.id,idSite:e.linkIdSite,date:ot["MatomoUrl"].parsed.value.date,period:ot["MatomoUrl"].parsed.value.period,segment:ot["MatomoUrl"].parsed.value.segment,subcategory:e.subcategoryLink})}`},truncate:io,htmlEntities(e){return ot["Matomo"].helper.htmlEntities(e)},isMultiSiteReport(e){return e.multiple_idsites&&e.multiple_idsites.split(",")}},computed:{isSuperUser(){return ot["Matomo"].hasSuperUserAccess},reports(){return dt.state.value.reports},sortedReports(){const e=this.searchFilter.toLowerCase(),t=[...this.reports].filter(t=>Object.keys(t).some(o=>{const i=t;return"string"===typeof i[o]&&-1!==i[o].toLowerCase().indexOf(e)}));return t.sort((e,t)=>{const o=parseInt(""+e.idcustomreport,10),i=parseInt(""+t.idcustomreport,10);return o-i}),t},isLoading(){return dt.state.value.isLoading},isUpdating(){return dt.state.value.isUpdating},reportTypesReadable(){return dt.state.value.reportTypesReadable},isEntityDuplicatorAvailable(){return"undefined"!==typeof no}}});lo.render=oo;var co=lo;const po={class:"manageReports"},mo={key:0},uo={key:1};function ho(e,t,o,i,r,n){const a=Object(s["resolveComponent"])("CustomReportsList"),l=Object(s["resolveComponent"])("CustomReportsEdit");return Object(s["openBlock"])(),Object(s["createElementBlock"])("div",po,[e.editMode?Object(s["createCommentVNode"])("",!0):(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",mo,[Object(s["createVNode"])(a)])),e.editMode?(Object(s["openBlock"])(),Object(s["createElementBlock"])("div",uo,[Object(s["createVNode"])(l,{"id-custom-report":e.idCustomReport,"browser-archiving-disabled":e.browserArchivingDisabled,"re-archive-last-n":e.reArchiveLastN,"max-dimensions":e.maxDimensions,"is-cloud":e.isCloud},null,8,["id-custom-report","browser-archiving-disabled","re-archive-last-n","max-dimensions","is-cloud"])])):Object(s["createCommentVNode"])("",!0)])}var bo=Object(s["defineComponent"])({props:{browserArchivingDisabled:Boolean,reArchiveLastN:Number,maxDimensions:Number,isCloud:Boolean},components:{CustomReportsList:co,CustomReportsEdit:vt},data(){return{editMode:!1,idCustomReport:null}},watch:{editMode(){$(".ui-tooltip").remove()}},created(){Object(s["watch"])(()=>ot["MatomoUrl"].hashParsed.value.idCustomReport,e=>{this.initState(e)}),this.initState(ot["MatomoUrl"].hashParsed.value.idCustomReport)},methods:{removeAnyReportNotification(e=!0){ot["NotificationsStore"].remove("reportsmanagement"),e&&ot["NotificationsStore"].remove("reportsmanagementProductMetric")},initState(e){if(e){if("0"===e){const e={isAllowed:!0};if(ot["Matomo"].postEvent("CustomReports.initAddReport",e),e&&!e.isAllowed)return this.editMode=!1,void(this.idCustomReport=null)}this.editMode=!0,this.idCustomReport=parseInt(e,10)}else this.editMode=!1,this.idCustomReport=null;this.removeAnyReportNotification(!e)}}});bo.render=ho;var vo=bo;
/**
 * Copyright (C) InnoCraft Ltd - All rights reserved.
 *
 * NOTICE:  All information contained herein is, and remains the property of InnoCraft Ltd.
 * The intellectual and technical concepts contained herein are protected by trade secret
 * or copyright law. Redistribution of this information or reproduction of this material is
 * strictly forbidden unless prior written permission is obtained from InnoCraft Ltd.
 *
 * You shall use this code only in accordance with the license agreement obtained from
 * InnoCraft Ltd.
 *
 * @link https://www.innocraft.com/
 * @license For license details see https://www.innocraft.com/license
 */}})}));
//# sourceMappingURL=CustomReports.umd.min.js.map